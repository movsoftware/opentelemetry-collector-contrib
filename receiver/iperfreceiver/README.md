# Iperf Receiver

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [alpha]: metrics   |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Areceiver%2Fiperf%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Areceiver%2Fiperf) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Areceiver%2Fiperf%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Areceiver%2Fiperf) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=receiver_iperf)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=receiver_iperf&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    |  |

[alpha]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#alpha
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

The Iperf receiver runs network performance tests using iperf3 and collects metrics about network bandwidth, latency, packet loss, and other network performance indicators. It can operate in either client or server mode.

## Prerequisites

This receiver requires iperf3 to be installed on the system:

### Linux/Unix
```bash
sudo apt-get install iperf3    # Debian/Ubuntu
sudo yum install iperf3         # RHEL/CentOS
brew install iperf3             # macOS
```

### Windows
Download and install from: https://iperf.fr/iperf-download.php

## Configuration

The receiver can operate in two modes:
- **Client mode** (default): Runs tests against specified iperf3 servers
- **Server mode**: Runs an iperf3 server and collects metrics from incoming tests

### Example Configuration - Client Mode

```yaml
receivers:
  iperf:
    mode: client  # default
    collection_interval: 60s
    targets:
      - host: 192.168.1.100
        port: 5201
        duration: 10s
        streams: 4
        protocol: tcp
      - host: speedtest.example.com
        port: 5201
        duration: 5s
        protocol: udp
        bandwidth: 10M
```

### Example Configuration - Server Mode

```yaml
receivers:
  iperf:
    mode: server
    server_port: 5201
```

### Configuration Options

#### Top-level Configuration

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `mode` | string | `client` | Operating mode: `client` or `server` |
| `server_port` | int | `5201` | Port to listen on when in server mode |
| `collection_interval` | duration | `60s` | How often to run tests (client mode) |
| `targets` | []TargetConfig | `[]` | List of iperf3 servers to test against (client mode) |

#### Target Configuration (Client Mode)

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `host` | string | *required* | Hostname or IP of the iperf3 server |
| `port` | int | *required* | Port of the iperf3 server |
| `duration` | duration | `10s` | Test duration |
| `streams` | int | `1` | Number of parallel client streams |
| `protocol` | string | `tcp` | Protocol: `tcp`, `udp`, or `sctp` |
| `reverse` | bool | `false` | Run in reverse mode (server sends, client receives) |
| `bandwidth` | string | - | Target bandwidth for UDP tests (e.g., "1M", "100K") |
| `window` | string | - | Socket buffer size |
| `mss` | int | - | TCP maximum segment size |
| `no_delay` | bool | `false` | Disable Nagle's Algorithm (TCP) |
| `omit` | int | `0` | Seconds to omit from the beginning of the test |
| `zero_copy` | bool | `false` | Use zero-copy sendfile() method (TCP) |
| `congestion` | string | - | TCP congestion algorithm (e.g., "cubic", "reno") |

## Metrics

The following metrics are collected:

### Network Performance Metrics

| Metric | Description | Unit | Attributes |
|--------|-------------|------|------------|
| `iperf.bandwidth` | Network bandwidth measured during test | bit/s | `protocol`, `direction`, `streams` |
| `iperf.transfer` | Total bytes transferred | By | `protocol`, `direction` |
| `iperf.test.duration` | Duration of the test | s | `protocol` |

### TCP-specific Metrics

| Metric | Description | Unit | Attributes |
|--------|-------------|------|------------|
| `iperf.retransmits` | Number of TCP retransmissions | {retransmission} | `protocol` |
| `iperf.cwnd` | TCP congestion window size (optional) | By | `protocol` |

### UDP-specific Metrics

| Metric | Description | Unit | Attributes |
|--------|-------------|------|------------|
| `iperf.jitter` | Jitter measured during test | ms | `protocol`, `direction` |
| `iperf.packet_loss` | Percentage of packets lost | % | `protocol`, `direction` |

### System Metrics

| Metric | Description | Unit | Attributes |
|--------|-------------|------|------------|
| `iperf.cpu.utilization` | CPU utilization during test (optional) | % | `protocol`, `direction` |
| `iperf.test.error` | Count of test errors | {error} | `error.message` |

### Resource Attributes

All metrics include the following resource attributes:
- `iperf.target.host`: The hostname or IP address of the iperf3 server
- `iperf.target.port`: The port number of the iperf3 server

## Example Output

When configured properly, the receiver produces metrics like:

```
iperf.bandwidth{protocol="tcp",direction="send",streams="4"} 941235200
iperf.transfer{protocol="tcp",direction="send"} 1176544000
iperf.retransmits{protocol="tcp"} 0
iperf.test.duration{protocol="tcp"} 10.05
```

## Advanced Configuration Examples

### Multi-target Testing

```yaml
receivers:
  iperf:
    collection_interval: 5m
    targets:
      # LAN test
      - host: 192.168.1.1
        port: 5201
        duration: 30s
        streams: 8
        protocol: tcp
      # WAN test
      - host: speedtest.remote.com
        port: 5201
        duration: 10s
        protocol: tcp
        window: 416K
      # UDP jitter test
      - host: voip.test.com
        port: 5201
        duration: 10s
        protocol: udp
        bandwidth: 1M
```

### High-Performance Testing

```yaml
receivers:
  iperf:
    targets:
      - host: highspeed.local
        port: 5201
        duration: 60s
        streams: 16
        protocol: tcp
        zero_copy: true
        window: 4M
        mss: 9000  # Jumbo frames
        congestion: bbr
```

## Troubleshooting

### Common Issues

1. **Connection refused**: Ensure the iperf3 server is running on the target host
2. **Permission denied**: The receiver may need appropriate network permissions
3. **High CPU usage**: Reduce the number of parallel streams or increase collection interval
4. **Inconsistent results**: Use the `omit` parameter to skip the TCP slow-start phase

### Debug Logging

Enable debug logging to see detailed test output:

```yaml
service:
  telemetry:
    logs:
      level: debug
```